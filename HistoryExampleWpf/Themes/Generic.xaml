<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:HistoryExampleWpf.Controls">

  <BooleanToVisibilityConverter x:Key="B2VConverter" />

  <ControlTemplate x:Key="StateTemplate" TargetType="{x:Type controls:State}">
    <Border x:Name="Border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}"
        BorderThickness="{TemplateBinding BorderThickness}"
        CornerRadius="{Binding CornerRadius, RelativeSource={RelativeSource TemplatedParent}}">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition />
          <RowDefinition Height="3*" />
          <RowDefinition />
        </Grid.RowDefinitions>
        <Viewbox Grid.Row="1" Stretch="Uniform">
          <TextBlock Margin="2" Text="{Binding DisplayName, RelativeSource={RelativeSource TemplatedParent}}"
              VerticalAlignment="Center" HorizontalAlignment="Center" />
        </Viewbox>
        <Path x:Name="Composite" Grid.Row="1" Grid.RowSpan="2" Margin="6 1" Stroke="{TemplateBinding BorderBrush}"
            StrokeThickness="1" HorizontalAlignment="Right" VerticalAlignment="Bottom" Visibility="Collapsed">
          <Path.Data>
            <GeometryGroup>
              <EllipseGeometry Center="3,3" RadiusX="3" RadiusY="3"></EllipseGeometry>
              <LineGeometry StartPoint="6,3" EndPoint="10,3"></LineGeometry>
              <EllipseGeometry Center="13,3" RadiusX="3" RadiusY="3"></EllipseGeometry>
            </GeometryGroup>
          </Path.Data>
        </Path>
      </Grid>
    </Border>
    <ControlTemplate.Triggers>
      <Trigger Property="IsComposite" Value="True">
        <Setter Property="Visibility" Value="Visible" TargetName="Composite" />
      </Trigger>
      <Trigger Property="IsSelected" Value="True">
        <Setter Property="BorderBrush"
            Value="{Binding SelectedBorderBrush, RelativeSource={RelativeSource TemplatedParent}}" TargetName="Border" />
        <Setter Property="BorderThickness"
            Value="{Binding SelectedBorderThickness, RelativeSource={RelativeSource TemplatedParent}}"
            TargetName="Border" />
        <Setter Property="Background"
            Value="{Binding SelectedBackground, RelativeSource={RelativeSource TemplatedParent}}" TargetName="Border" />
      </Trigger>
    </ControlTemplate.Triggers>
  </ControlTemplate>

  <Style TargetType="{x:Type controls:State}">
    <Setter Property="Template" Value="{StaticResource StateTemplate}" />
    <Setter Property="SelectedBorderBrush" Value="Red" />
    <Setter Property="BorderBrush" Value="Black" />
    <Setter Property="SelectedBorderThickness" Value="2.0" />
    <Setter Property="BorderThickness" Value="1.0" />
  </Style>

  <ControlTemplate x:Key="StartStateTemplate" TargetType="{x:Type controls:InitialState}">
    <Grid>
      <Ellipse x:Name="Ellipse" Fill="Transparent" Stroke="Transparent" StrokeDashArray="2 2" StrokeDashCap="Flat"
          StrokeThickness="0.5" />
      <Ellipse Fill="{TemplateBinding Background}" Stroke="Transparent" StrokeThickness="0" Margin="2" />
    </Grid>
    <ControlTemplate.Triggers>
      <Trigger Property="IsSelected" Value="True">
        <Setter Property="Stroke" Value="{Binding SelectedBorderBrush, RelativeSource={RelativeSource TemplatedParent}}"
            TargetName="Ellipse" />
        <Setter Property="Fill" Value="{Binding SelectedBackground, RelativeSource={RelativeSource TemplatedParent}}"
            TargetName="Ellipse" />
      </Trigger>
    </ControlTemplate.Triggers>
  </ControlTemplate>

  <Style TargetType="{x:Type controls:InitialState}">
    <Setter Property="Template" Value="{StaticResource StartStateTemplate}" />
    <Setter Property="SelectedBorderBrush" Value="Red" />
    <Setter Property="Background" Value="Black" />
  </Style>

  <ControlTemplate x:Key="FinalStateTemplate" TargetType="{x:Type controls:FinalState}">
    <Grid>
      <Ellipse x:Name="Ellipse" Fill="Transparent" Stroke="Transparent" StrokeDashArray="2 2" StrokeDashCap="Flat"
          StrokeThickness="0.5" />
      <Ellipse Fill="Transparent" Stroke="{TemplateBinding Background}" StrokeThickness="1" Margin="2" />
      <Ellipse Fill="{TemplateBinding Background}" Stroke="Transparent" StrokeThickness="0" Margin="5" />
    </Grid>
    <ControlTemplate.Triggers>
      <Trigger Property="IsSelected" Value="True">
        <Setter Property="Stroke" Value="{Binding SelectedBorderBrush, RelativeSource={RelativeSource TemplatedParent}}"
            TargetName="Ellipse" />
        <Setter Property="Fill" Value="{Binding SelectedBackground, RelativeSource={RelativeSource TemplatedParent}}"
            TargetName="Ellipse" />
      </Trigger>
    </ControlTemplate.Triggers>
  </ControlTemplate>

  <Style TargetType="{x:Type controls:FinalState}">
    <Setter Property="Template" Value="{StaticResource FinalStateTemplate}" />
    <Setter Property="SelectedBorderBrush" Value="Red" />
    <Setter Property="Background" Value="Black" />
  </Style>
</ResourceDictionary>
